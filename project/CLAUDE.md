# 天池推荐算法竞赛 - 项目记录

## 重要修改记录

### 2024-09-26: 算法竞赛项目极简化重构
- **背景**: 算法竞赛项目不需要复杂的工程化结构，需要聚焦核心算法实现
- **重构策略**:
  - **删除冗余结构**: 移除src/、experiments/、final/、scripts/等复杂目录
  - **三脚本核心**: 将整个算法流程简化为3个核心Python脚本
  - **流程标准化**: 候选集生成 → 特征工程 → LightGBM训练预测
- **核心文件**:
  - `1_candidate_generation.py`: 从用户行为数据D筛选商品子集P的候选推荐对
  - `2_feature_engineering.py`: 构建用户特征、商品特征、交互特征
  - `3_lgbm_training.py`: LightGBM模型训练和预测，输出submission.txt
- **算法核心**:
  - **任务理解**: 利用全量行为数据D预测用户对商品子集P的购买行为
  - **候选策略**: 历史交互用户-商品对作为候选集
  - **特征体系**: 用户活跃度+商品流行度+交互历史的多维特征
  - **模型选择**: LightGBM二分类 + Top-K推荐策略
- **技术优势**:
  - 代码结构清晰，易于理解和修改
  - 算法流程标准化，便于调试优化
  - 符合竞赛快速迭代的需求
- **影响文件**: 重构为3个核心脚本 + README.md

## 算法思路

### 任务定义
- **商品全集I**: 所有商品
- **商品子集P**: tianchi_fresh_comp_train_item_online.txt (推荐目标)
- **用户行为数据D**: 用户在商品全集I上的行为数据
- **目标**: 利用D预测用户对P的购买行为(2014-12-19)

### 三阶段流程
1. **候选集生成**: 筛选可能的用户-商品推荐对
2. **特征工程**: 构建预测购买行为的特征体系
3. **模型预测**: LightGBM训练并生成最终推荐

### 运行方式
```bash
python 1_candidate_generation.py  # 生成候选集
python 2_feature_engineering.py   # 特征工程
python 3_lgbm_training.py         # 模型训练预测
```

### 2024-09-26: 数据泄露问题修复
- **问题发现**: AUC高达0.999但F1仅0.0619，存在严重数据泄露
- **根本原因**: 候选集构造导致训练验证分布不一致
  - **正样本**: 62%来自历史无交互的"冷启动"购买（ui_days_since_last_action=999）
  - **负样本**: 98%来自最近7天有交互但未购买的用户-商品对
  - **泄露机制**: 模型学到"时间间隔大→正样本，时间间隔小→负样本"的虚假规律
- **修复方案**:
  - **候选集对齐**: 新增ALIGN_RECALL=1，训练和预测使用相同召回策略
  - **正样本过滤**: 新增POS_FILTER_IN_RECALL=1，仅保留召回范围内的正样本
  - **特征清理**: 支持DROP_TIME_GAP_FEATURES=1排除强时间依赖特征
  - **配置增强**: config.ini新增[recall]段，支持灵活配置
- **技术改进**:
  - 三个脚本都新增configparser支持，统一配置管理
  - 环境变量和配置文件双重配置机制
  - 时间窗口可配置化（label_date参数）
  - 负样本采样策略优化（分桶采样）
- **影响文件**:
  - 修改: 1_candidate_generation.py, 2_feature_engineering.py, 3_lgbm_training.py
  - 新增: config/config.ini [recall]段
  - 更新: README.md (新增数据泄露修复说明)
  - 更新: .gitignore (排除dataset/、*.csv等文件)

## 代码规范
- 无复杂目录结构，保持项目根目录简洁
- 代码中不使用emoji，保持专业性
- 每个脚本功能单一明确，便于调试
- 统一使用configparser + 环境变量配置机制