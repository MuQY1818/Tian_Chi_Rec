# 推荐模型说明

## 🎯 比赛任务
预测用户在2014年12月19日会购买哪些商品，输出`user_id\titem_id`对。

## 📊 数据处理

### 输入数据
- **用户行为**: 11.65亿条记录 (50GB)
- **商品子集**: 678万商品
- **时间范围**: 2014.11.18-2014.12.18

### 处理流程
1. **数据清洗**: 过滤异常值，处理缺失值
2. **序列构建**: 按用户分组构建行为序列
3. **特征工程**: 生成57维特征向量
4. **数据划分**: 按时间划分训练/验证/测试集

## 🤖 模型架构

### 1. GRU4Rec (序列模型)
**用途**: 处理用户行为序列

```python
输入: 用户历史行为序列 [item1, item2, item3, ...]
处理: GRU + 注意力机制
输出: 商品购买概率 [0.1, 0.8, 0.3, ...]
```

**特点**:
- 捕捉时间序列模式
- 注意力机制关注重要行为
- 行为类型加权 (浏览=1, 收藏=2, 购物车=3, 购买=4)

### 2. DeepFM (特征交叉模型)
**用途**: 学习特征间复杂关系

```python
输入: 57维特征向量 [用户特征, 商品特征, 交互特征, ...]
处理: FM(显式交叉) + Deep Learning(隐式交叉)
输出: 商品购买概率
```

**特点**:
- 同时处理稀疏和稠密特征
- 自动学习特征交叉
- 记忆能力 + 泛化能力

### 3. 随机森林 (基线模型)
**用途**: 提供基准性能

```python
输入: 57维特征向量
处理: 多棵决策树投票
输出: 商品购买概率
```

**特点**:
- 抗过拟合能力强
- 特征重要性分析
- 训练速度快

## 🎯 模型融合

### 融合策略
```python
final_score = 0.6 * GRU4Rec_score + 0.3 * DeepFM_score + 0.1 * RF_score
```

### 权重调整
- 基于验证集F1分数动态调整
- GRU4Rec权重最高 (序列信息最重要)
- DeepFM次之 (特征交叉有价值)
- 随机森林最低 (提供稳定性)

## 📈 预期效果

### 性能目标
- **GRU4Rec**: F1 ≈ 0.75
- **DeepFM**: F1 ≈ 0.78  
- **集成模型**: F1 ≈ 0.82

### 关键优势
1. **大规模处理**: 能处理50GB原始数据
2. **序列建模**: 充分利用用户行为时序信息
3. **特征融合**: 多维度特征全面建模
4. **模型集成**: 多模型互补提升性能

## 🚀 运行方式

### 快速开始
```bash
# 安装依赖
pip install -r config/requirements.txt

# 运行完整系统
python main_large_scale.py --mode full --model_type ensemble
```

### 分步运行
```bash
# 1. 数据预处理
python main_large_scale.py --mode preprocess

# 2. 训练GRU4Rec
python main_large_scale.py --mode train --model_type gru4rec

# 3. 训练DeepFM
python main_large_scale.py --mode train --model_type deepfm

# 4. 生成最终结果
python main_large_scale.py --mode predict --model_type ensemble
```

## 📝 输出结果

### 最终文件
```
submission.txt
user_id    item_id
1001      123456
1001      789012
1002      345678
...
```

### 输出逻辑
1. 对每个用户预测所有候选商品的购买概率
2. 选择概率最高的Top-5商品
3. 确保商品来自商品子集P
4. 按user_id排序输出

## 🎯 核心创新

1. **端到端**: 从原始数据到最终输出的完整流程
2. **大规模**: 处理50GB数据，支持全量训练
3. **多模型**: GRU4Rec + DeepFM + 随机森林
4. **高精度**: 预期F1分数0.82+

这个模型架构专门针对比赛需求设计，能够充分利用大规模数据生成高质量的购买预测。